extends base

include mixins/_multiselect.pug
include mixins/_editableTable.pug


append head
    link(rel="stylesheet", href="/css/spinner.css")
    link(rel="stylesheet", href="/css/form-template.css")
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous")

block content
    main.main
        .breadcrumb-container
            ol.breadcrumb
                li.breadcrumb__item: a.breadcrumb__link(href=`#`) PROJECTS
                li.breadcrumb__item: a.breadcrumb__link(href=`#`) PROJECT#AADD
                li.breadcrumb__item: a.breadcrumb__link(href=`#`) ISSUES
                li.breadcrumb__item: a.breadcrumb__link(href=`#`) ISSUE#AADD-001
        .app-wrapper
            h1.heading-page= title
            .app__header
                if (formMode !== 'preview')
                    a(href=`${formMode == 'create' ? `/projects/${projectId}/issues`: `/projects/${issue.project._id}/issues/${issue._id}/preview`}`).btn.btn--small.btn--light.align--right Cancel
                    button#saveFormBtn(form="issueForm", type="submit").btn.btn--small.btn--light.align--right Save
                else 
                    a(href=`/projects/${issue.project._id}/issues`).btn.btn--small.btn--light.align--left Back to Issues
                    a(href=`/projects/${issue.project._id}/issues/${issue._id}/update`).btn.btn--small.btn--light.align--right Edit
                    button#deleteFormBtn(form="issueForm", type="button").btn.btn--small.btn--light.align--right Delete
        form#issueForm.form-template(data-resource=`projects/${projectId}/issues`, data-id=formMode!=='create' ? issue._id : '')
            .form-template__field
                label.form-template__label(for="id") ID
                input#id.form-template__input(type=`text` disabled, value=`${formMode!=='create' ? issue.issueId : ''}`)
            .form-template__field
                label.form-template__label(for="author") Author
                input#author.form-template__input(type="text" disabled, value=`${formMode!=='create' ? issue.author.name : ''}`)
            .form-template__field
                label.form-template__label(for="status") Status
                input#status.form-template__input(type="text" disabled=formMode!=="update", name="status", value=`${formMode!=='create' ? issue.status : ''}`)
            .form-template__field.new-line
                label.form-template__label(for="name") Name
                input#name.form-template__input(type="text" disabled=formMode!=="update" && formMode !=="create", name="name", value=`${formMode!=='create' ? issue.name : ''}`)
            .form-template__field
                label.form-template__label(for="priority") Priority
                input#priority.form-template__input(type="text" disabled=formMode!=="update" && formMode !=="create", name="priority", value=`${formMode!=='create' ? issue.priority : ''}`)  
            .form-template__field
                label.form-template__label(for="difficulty") Difficulty
                input#difficulty.form-template__input(type="number" disabled=formMode!=="update" && formMode !=="create", name="difficulty", value=`${formMode!=='create' ? issue.difficulty : ''}`)             
            .form-template__field
                label.form-template__label(for="deadline") Deadline
                input#deadline.form-template__input(type="text", placeholder="MM/DD/YYYY" disabled=formMode!=="update" && formMode !=="create" , name="deadline", value=`${formMode!=='create' && issue.deadline ?  issue.deadline.toLocaleDateString('en-GB') : ''}`)
            .form-template__field.colspan2
                label.form-template__label(for="description") Description
                textarea#description.form-template__textarea(disabled=formMode!=="update" && formMode !=="create", name="description")=`${formMode!=='create' ? issue.description : ''}`
            .form-template__field.colspan2.new-line
                +userMultiselect("assignees", "Assignees", (issue) ?  issue.assignees : [], users)
            .form-template__field.colspan3.new-line
                label.form-template__label(for="acceptanceCriterias") Acceptance Criteria
                table.list
                    tr.list__row--heading
                        th.list__heading: span Criterion
                        th.list__heading: span Created
                        th.list__heading: span Solved
                    tr.list__row.list__row--form
                        td.list__data.list__data--form: span UV A280 (biologics only): Initial samples: 85-115% of the target 
                        td.list__data.list__data--form: span 16/11/2020
                        td.list__data.list__data--form: span No
                    tr.list__row.list__row--form
                        td.list__data.list__data--form: span Monomer: >= 90.0%
                        td.list__data.list__data--form: span 16/11/2020
                        td.list__data.list__data--form: span No
                    tr.list__row.list__row--form
                        td.list__data.list__data--form: span HP-SEC (biologics only): High mol. wt species: <=5.00%
                        td.list__data.list__data--form: span 16/11/2020
                        td.list__data.list__data--form: span Yes
                    tr.list__row.list__row--form
                        td.list__data.list__data--form: span Contents by HPLC (small molecule): Initial samples: 85-115% of target
                        td.list__data.list__data--form: span 16/11/2020
                        td.list__data.list__data--form: span No
            .form-template__field.colspan3.new-line
                +editableTable('acceptanceCriterias', 'Acceptance Criteria', (issue.acceptanceCriterias) ?  issue.acceptanceCriterias : [], 'ID', 'Criterion', 'Created on', 'Solved')